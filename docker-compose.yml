version: '3'
services:
  product_service:
    container_name: "product_service"
    build:
      context: ./nab-product-service
    environment:
      ENV: "development"
      PORT: 3000
      DB_NAME: ${PRODUCT_DATABASE_NAME}
      DB_USERNAME: ${PRODUCT_DATABASE_USERNAME}
      DB_PASSWORD: ${PRODUCT_DATABASE_PASSWORD}
      DB_HOST: "localhost"
      AMQP_URL: amqp://${RABBITMQ_USERNAME}:${RABBITMQ_PASSWORD}@localhost
      AMQP_USER_ACTIVITY_QUEUE: ${ACTIVITY_QUEUE}
    networks:
      - product_network
    ports:
      - "3000:3000"
    depends_on:
      - product_db
      - message_queue
  product_db:
    container_name: "product_db"
    image: "mysql:latest"
    command: --default-authentication-plugin=mysql_native_password
    restart: always
    ports:
    - "3306:3306"
    environment:
#      MYSQL_ROOT_PASSWORD: ${PRODUCT_MYSQL_ROOTPASSWORD}
      MYSQL_DATABASE: ${PRODUCT_MYSQL_DATABASE}
      MYSQL_USER: ${PRODUCT_MYSQL_USER}
    networks:
      - product_network
  message_queue:
    container_name: "message_queue"
    image: "bitnami/rabbitmq"
    environment:
      RABBITMQ_USERNAME: ${RABBITMQ_USERNAME}
      RABBITMQ_PASSWORD: ${RABBITMQ_PASSWORD}

  activity_service:
  activity_db:
    image: "mongo:latest"


networks:
  product_network:
    driver: bridge
  activity_network:
    driver: bridge
  main_network:
    driver: bridge


####################################
#  default:
#    driver: bridge
#    ipam:
#      config:
#          - subnet: 172.16.57.0/24